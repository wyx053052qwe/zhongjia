/*
 * FilePondPluginImagePreview 3.1.6
 * Licensed under MIT, https://opensource.org/licenses/MIT
 * Please visit https://pqina.nl/filepond for details.
 */

/* eslint-disable */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.FilePondPluginImagePreview=t()}(this,function(){"use strict";var o={type:"spring",stiffness:.5,damping:.45,mass:10},v=function(e,t){return{x:e,y:t}},c=function(e,t){return v(e.x-t.x,e.y-t.y)},w=function(e,t){return Math.sqrt((a=c(i=e,r=t),n=c(i,r),a.x*n.x+a.y*n.y));var i,r,a,n},I=function(e,t){var i=e,r=t,a=1.5707963267948966-t,n=Math.sin(1.5707963267948966),o=Math.sin(r),c=Math.sin(a),s=Math.cos(a),l=i/n;return v(s*(l*o),s*(l*c))},_=function(e,t,i,r){var a,n,o,c,s,l,h,f,d,p=.5<r.x?1-r.x:r.x,u=.5<r.y?1-r.y:r.y,g=2*p*e.width,E=2*u*e.height,m=(n=i,o=(a=t).width,c=a.height,s=I(o,n),l=I(c,n),h=v(a.x+Math.abs(s.x),a.y-Math.abs(s.y)),f=v(a.x+a.width+Math.abs(l.y),a.y+Math.abs(l.x)),d=v(a.x-Math.abs(l.y),a.y+a.height-Math.abs(l.x)),{width:w(h,f),height:w(h,d)});return Math.max(m.width/g,m.height/E)},s=function(e){return e.utils.createView({name:"image-bitmap",tag:"canvas",ignoreRect:!0,mixins:{styles:["scaleX","scaleY"]},create:function(e){var t,i,r=e.root,a=e.props;t=a.image,(i=(i=r.element)||document.createElement("canvas")).width=t.width,i.height=t.height,i.getContext("2d").drawImage(t,0,0)}})},a=function(n){return n.utils.createView({name:"image-clip",tag:"div",ignoreRect:!0,mixins:{apis:["crop","width","height"],styles:["width","height"]},create:function(e){var r,t=e.root,i=e.props;t.ref.image=t.appendChildView(t.createChildView((r=n).utils.createView({name:"image-canvas-wrapper",tag:"div",ignoreRect:!0,mixins:{apis:["crop","width","height"],styles:["originX","originY","translateX","translateY","scaleX","scaleY","rotateZ"],animations:{originX:o,originY:o,scaleX:o,scaleY:o,translateX:o,translateY:o,rotateZ:o}},create:function(e){var t=e.root,i=e.props;i.width=i.image.width,i.height=i.image.height,t.ref.image=t.appendChildView(t.createChildView(s(r),{image:i.image}))},write:function(e){var t=e.root,i=e.props.crop.flip,r=t.ref.image;r.scaleX=i.horizontal?-1:1,r.scaleY=i.vertical?-1:1}}),Object.assign({},i)));var a=t.query("GET_IMAGE_PREVIEW_TRANSPARENCY_INDICATOR");null!==a&&(t.element.dataset.transparencyIndicator="grid"===a?a:"color")},write:function(e){var t=e.root,i=e.props,r=i.crop,a=i.width,n=i.height;t.ref.image.crop=r;var o,c,s,l,h={x:0,y:0,width:a,height:n,center:{x:.5*a,y:.5*n}},f={width:t.ref.image.width,height:t.ref.image.height},d={x:r.center.x*f.width,y:r.center.y*f.height},p={x:h.center.x-f.width*r.center.x,y:h.center.y-f.height*r.center.y},u=2*Math.PI+r.rotation%(2*Math.PI),g=r.aspectRatio||f.height/f.width,E=_(f,(s=(o=h).width,(l=s*(c=g))>o.height&&(s=(l=o.height)/c),{x:.5*(o.width-s),y:.5*(o.height-l),width:s,height:l}),u,r.center),m=r.zoom*E,v=t.ref.image;v.originX=d.x,v.originY=d.y,v.translateX=p.x,v.translateY=p.y,v.rotateZ=u,v.scaleX=m,v.scaleY=m}})},n="<radialGradient id=\"filepond--image-preview-radial-gradient\" cx=\".5\" cy=\"1.25\" r=\"1.15\">\n<stop offset='50%' stop-color='#000000'/>\n<stop offset='56%' stop-color='#0a0a0a'/>\n<stop offset='63%' stop-color='#262626'/>\n<stop offset='69%' stop-color='#4f4f4f'/>\n<stop offset='75%' stop-color='#808080'/>\n<stop offset='81%' stop-color='#b1b1b1'/>\n<stop offset='88%' stop-color='#dadada'/>\n<stop offset='94%' stop-color='#f6f6f6'/>\n<stop offset='100%' stop-color='#ffffff'/>\n</radialGradient>\n\n<mask id=\"filepond--image-preview-masking\">\n<rect x=\"0\" y=\"0\" width=\"500\" height=\"200\" fill=\"url(#filepond--image-preview-radial-gradient)\"></rect>\n</mask>",e=function(){if(document.body&&!document.querySelector(".filepond--image-preview-sprite")){var e=document.createElementNS("http://www.w3.org/2000/svg","svg");e.setAttribute("class","filepond--image-preview-sprite"),e.style.cssText="position:absolute;width:0;height:0",e.innerHTML=n,document.body.appendChild(e)}},t="undefined"!=typeof navigator;t&&(e(),document.addEventListener("readystatechange",e));var h=!!t&&(document.documentMode||/Edge/.test(navigator.userAgent)),f=function(){self.onmessage=function(t){createImageBitmap(t.data.message.file).then(function(e){self.postMessage({id:t.data.id,message:e},[e])})}},l={1:function(){return[1,0,0,1,0,0]},2:function(e){return[-1,0,0,1,e,0]},3:function(e,t){return[-1,0,0,-1,e,t]},4:function(e,t){return[1,0,0,-1,0,t]},5:function(){return[0,1,1,0,0,0]},6:function(e,t){return[0,1,-1,0,t,0]},7:function(e,t){return[0,-1,-1,0,t,e]},8:function(e){return[0,-1,1,0,0,e]}},y=function(e,t,i,r){-1!==r&&e.transform.apply(e,function(e){if(Array.isArray(e)){for(var t=0,i=Array(e.length);t<e.length;t++)i[t]=e[t];return i}return Array.from(e)}(l[r](t,i)))},M=function(e){return/^image/.test(e.type)&&!/svg/.test(e.type)},T=function(e,t){return Math.floor(Math.sqrt(e/(t/4)))},d=function(s){var r,i=s.utils.createView({name:"image-preview-overlay",tag:"div",ignoreRect:!0,create:function(e){var t=e.root,i=e.props;t.element.classList.add("filepond--image-preview-overlay-"+i.status),t.element.innerHTML='<svg width="500" height="200" viewBox="0 0 500 200" preserveAspectRatio="none">\n                '+(h?"<defs>"+n+"</defs>":"")+'\n                <rect x="0" width="500" height="200" fill="currentColor" mask="url(#filepond--image-preview-masking)"></rect>\n            </svg>\n            '},mixins:{styles:["opacity"],animations:{opacity:{type:"spring",mass:25}}}}),l=(r=s).utils.createView({name:"image-preview",tag:"div",ignoreRect:!0,mixins:{apis:["crop"],styles:["translateY","scaleX","scaleY","opacity"],animations:{scaleX:o,scaleY:o,translateY:o,opacity:{type:"tween",duration:500}}},create:function(e){var t=e.root,i=e.props;t.ref.clip=t.appendChildView(t.createChildView(a(r),{image:i.image,crop:i.crop}))},write:function(e){var t=e.root,i=e.props,r=t.ref.clip,a=i.crop,n=i.image;r.crop=a;var o=n.height/n.width,c=a.aspectRatio||o,s=t.rect.inner.width,l=s,h=t.query("GET_IMAGE_PREVIEW_HEIGHT"),f=t.query("GET_IMAGE_PREVIEW_MIN_HEIGHT"),d=t.query("GET_IMAGE_PREVIEW_MAX_HEIGHT"),p=t.query("GET_PANEL_ASPECT_RATIO"),u=t.query("GET_ALLOW_MULTIPLE");p&&!u&&(h=s*p,c=p);var g=null!==h?h:Math.max(f,Math.min(s*c,d)),E=g/c;l<E&&(g=(E=l)*c),r.width=E,r.height=g}}),m=function(e){var t=e.root,i=e.props,r=i.id,a=t.query("GET_ITEM",{id:r});if(a){var n=i.preview,o=a.getMetadata("crop")||{center:{x:.5,y:.5},flip:{horizontal:!1,vertical:!1},zoom:1,rotation:0,aspectRatio:null},c=t.appendChildView(t.createChildView(l,{image:n,crop:o,opacity:0,scaleX:1.15,scaleY:1.15,translateY:15}),t.childViews.length);t.ref.images.push(c),c.opacity=1,c.scaleX=1,c.scaleY=1,c.translateY=0,setTimeout(function(){t.dispatch("DID_IMAGE_PREVIEW_SHOW",{id:r})},250)}},e=function(e){var t=e.root;t.ref.overlayShadow.opacity=1,t.ref.overlayError.opacity=0,t.ref.overlaySuccess.opacity=0},t=function(e){var t=e.root;t.ref.overlayShadow.opacity=.25,t.ref.overlayError.opacity=1};return s.utils.createView({name:"image-preview-wrapper",create:function(e){var t=e.root;t.ref.images=[],t.ref.imageViewBin=[],t.ref.overlayShadow=t.appendChildView(t.createChildView(i,{opacity:0,status:"idle"})),t.ref.overlaySuccess=t.appendChildView(t.createChildView(i,{opacity:0,status:"success"})),t.ref.overlayError=t.appendChildView(t.createChildView(i,{opacity:0,status:"failure"}))},styles:["height"],write:s.utils.createRoute({DID_IMAGE_PREVIEW_DRAW:function(e){var t=e.root,i=t.ref.images[t.ref.images.length-1];i.translateY=0,i.scaleX=1,i.scaleY=1,i.opacity=1},DID_IMAGE_PREVIEW_CONTAINER_CREATE:function(e){var p=e.root,u=e.props,a=s.utils.createWorker,n=u.id,g=p.query("GET_ITEM",n);if(g){var t,i,r,E=URL.createObjectURL(g.file),o=function(){var r;(r=E,new Promise(function(e,t){var i=new Image;i.crossOrigin="Anonymous",i.onload=function(){e(i)},i.onerror=function(e){t(e)},i.src=r})).then(c)},c=function(e){URL.revokeObjectURL(E);var t=(g.getMetadata("exif")||{}).orientation||-1,i=e.width,r=e.height;if(5<=t&&t<=8){var a=[r,i];i=a[0],r=a[1]}var n=window.devicePixelRatio,o=p.query("GET_IMAGE_PREVIEW_HEIGHT"),c=p.query("GET_IMAGE_PREVIEW_MIN_HEIGHT"),s=p.query("GET_IMAGE_PREVIEW_MAX_HEIGHT"),l=r/i,h=null!==o?o:Math.max(c,Math.min(r,s)),f=h/l;u.preview=function(e,t,i,r){t=Math.round(t),i=Math.round(i);var a=document.createElement("canvas");a.width=t,a.height=i;var n=a.getContext("2d");if(5<=r&&r<=8){var o=[i,t];t=o[0],i=o[1]}return y(n,t,i,r),n.drawImage(e,0,0,t,i),a}(e,Math.min(i,f*n*4),Math.min(r,h*n*4),t);var d=p.query("GET_IMAGE_PREVIEW_CALCULATE_AVERAGE_IMAGE_COLOR")?function(e){var t=Math.min(10/e.width,10/e.height),i=document.createElement("canvas"),r=i.getContext("2d"),a=i.width=Math.ceil(e.width*t),n=i.height=Math.ceil(e.height*t);r.drawImage(e,0,0,a,n);var o=null;try{o=r.getImageData(0,0,a,n).data}catch(e){return null}for(var c=o.length,s=0,l=0,h=0,f=0;f<c;f+=4)s+=o[f]*o[f],l+=o[f+1]*o[f+1],h+=o[f+2]*o[f+2];return{r:s=T(s,c),g:l=T(l,c),b:h=T(h,c)}}(e):null;g.setMetadata("color",d,!0),"close"in e&&e.close(),p.ref.overlayShadow.opacity=1,m({root:p,props:u})};t=E,i=function(e,t){if(p.dispatch("DID_IMAGE_PREVIEW_CALCULATE_SIZE",{id:n,width:e,height:t}),r=g.file,"createImageBitmap"in window&&M(r)){var i=a(f);i.post({file:g.file},function(e){i.terminate(),e?c(e):o()})}else o();var r},(r=new Image).onload=function(){var e=r.naturalWidth,t=r.naturalHeight;r=null,i(e,t)},r.src=t}},DID_UPDATE_ITEM_METADATA:function(e){var t=e.root,i=e.props;if("crop"===e.action.change.key&&t.ref.images.length){var r=t.query("GET_ITEM",{id:i.id});if(r){var a,n,o,c,s,l,h=r.getMetadata("crop"),f=t.ref.images[t.ref.images.length-1];1e-5<Math.abs(h.aspectRatio-f.crop.aspectRatio)?((l=(s={root:t}.root).ref.images.shift()).opacity=0,l.translateY=-15,s.ref.imageViewBin.push(l),m({root:t,props:i})):(n=(a={root:t,props:i}).root,o=a.props,(c=n.query("GET_ITEM",{id:o.id}))&&(n.ref.images[n.ref.images.length-1].crop=c.getMetadata("crop")))}}},DID_THROW_ITEM_LOAD_ERROR:t,DID_THROW_ITEM_PROCESSING_ERROR:t,DID_THROW_ITEM_INVALID:t,DID_COMPLETE_ITEM_PROCESSING:function(e){var t=e.root;t.ref.overlayShadow.opacity=.25,t.ref.overlaySuccess.opacity=1},DID_START_ITEM_PROCESSING:e,DID_REVERT_ITEM_PROCESSING:e},function(e){var i=e.root,t=i.query("GET_PANEL_ASPECT_RATIO");t&&(i.height=t*i.rect.width);var r=i.ref.imageViewBin.filter(function(e){return 0===e.opacity});i.ref.imageViewBin=i.ref.imageViewBin.filter(function(e){return 0<e.opacity}),r.forEach(function(e){return t=e,i.removeChildView(t),void t._destroy();var t}),r.length=0})})},i=function(e){var t=e.addFilter,i=e.utils,r=i.Type,n=i.createRoute,l=i.isFile,h=d(e);return t("CREATE_VIEW",function(e){var t=e.is,c=e.view,s=e.query;if(t("file")&&s("GET_ALLOW_IMAGE_PREVIEW")){var a=function(e,t){if(e.ref.imagePreview){var i=t.id,r=e.query("GET_ITEM",{id:i});if(r){var a=e.ref,n=a.imageWidth,o=a.imageHeight;if(n&&o){var c=(r.getMetadata("exif")||{}).orientation||-1;if(5<=c&&c<=8){var s=[o,n];n=s[0],o=s[1]}var l=e.query("GET_PANEL_ASPECT_RATIO"),h=e.query("GET_ALLOW_MULTIPLE"),f=r.getMetadata("crop")||{center:{x:.5,y:.5},flip:{horizontal:!1,vertical:!1},rotation:0,zoom:1,aspectRatio:o/n},d=!h&&l,p=d?l:f.aspectRatio||o/n,u=e.query("GET_IMAGE_PREVIEW_HEIGHT"),g=e.query("GET_IMAGE_PREVIEW_MIN_HEIGHT"),E=e.query("GET_IMAGE_PREVIEW_MAX_HEIGHT");if(d&&(u=e.rect.element.width*l),!M(r.file)){var m=2048/n;n*=m,o*=m}((n=(o=null!==u?u:Math.max(g,Math.min(o,E)))/p)>e.rect.element.width||d)&&(o=(n=e.rect.element.width)*p),e.ref.imagePreview.element.style.cssText="height:"+Math.round(o)+"px"}}}};c.registerWriter(n({DID_LOAD_ITEM:function(e){var t=e.root,i=e.props.id,r=s("GET_ITEM",i);if(r&&l(r.file)&&!r.archived){var a=r.file;if(/^image/.test(a.type)){var n="createImageBitmap"in(window||{}),o=s("GET_IMAGE_PREVIEW_MAX_FILE_SIZE");!n&&o&&a.size>o||(t.ref.imagePreview=c.appendChildView(c.createChildView(h,{id:i})),t.dispatch("DID_IMAGE_PREVIEW_CONTAINER_CREATE",{id:i}))}}},DID_IMAGE_PREVIEW_CALCULATE_SIZE:function(e){var t=e.root,i=e.props,r=e.action;t.ref.imageWidth=r.width,t.ref.imageHeight=r.height,a(t,i)},DID_UPDATE_ITEM_METADATA:function(e){var t=e.root,i=e.props;"crop"===e.action.change.key&&a(t,i)}}))}}),{options:{allowImagePreview:[!0,r.BOOLEAN],imagePreviewHeight:[null,r.INT],imagePreviewMinHeight:[44,r.INT],imagePreviewMaxHeight:[256,r.INT],imagePreviewMaxFileSize:[null,r.INT],imagePreviewTransparencyIndicator:[null,r.STRING],imagePreviewCalculateAverageImageColor:[!1,r.BOOLEAN]}}};return"undefined"!=typeof window&&void 0!==window.document&&document&&document.dispatchEvent(new CustomEvent("FilePond:pluginloaded",{detail:i})),i});